# telemetry-lambda-resources

[![Brought to you by Telemetry Team](https://img.shields.io/badge/MDTP-Telemetry-40D9C0?style=flat&labelColor=000000&logo=gov.uk)](https://confluence.tools.tax.service.gov.uk/display/TEL/Telemetry)

<!-- toc -->

- [Purpose](#purpose)
- [Updating the submodule](#updating-the-submodule)
  * [Pre-requisites](#pre-requisites)
  * [Example Usage](#example-usage)
- [Tools](#tools)

<!-- tocstop -->

This repo contains common resources for Telemetry AWS Lambda builds. Only long-term, common and stable files should be
added, e.g. scripts or configurations that need to be changed in unison for a number of Lambdas should go here.

## Purpose

The repo is meant to be used as a submodule inside `telemetry-lambda-*` repos. To add the submodule to your repo run the
command below in the root of your repo.

```shell
git submodule add --name resources --force -b main git@github.com:hmrc/telemetry-lambda-resources resources/
```

Once the submodule has been added you can run `resources/tools/update_ami.sh` to update the AMI repo to use the
submodule. This works for new (empty) and existing AMI repositories. If it is an existing repository that is migrating
to use the submodule then some files will be overwritten with links to the repo. All files will be stored in the folder
`bkup` in the root of the repo. Some manual work is necessary but at the end of the process the script prints out
what else needs to be done.

## Updating the submodule

Whenever the submodule is updated it needs to be updated and committed in all repos that use it. The repo contains a
script to run from the main module that will update the submodule accordingly. Just run `./tools/bump_lambda_resources.sh`
from your branch and the submodule will be updated, committed, pull request raised and a file `pr_list.txt` that will
contain a list of all the PRs generated by the script.

### Pre-requisites

- bash
- git
- [The GitHub CLI Tool](https://github.com/cli/cli) `gh` installed locally
- `gh auth login` has been run successfully

### Example Usage
```shell
./tools/bump_lambda_resources.sh ~/source/hmrc TEL-1000 "Co-authored-by: Lee Myring <29373851+thinkstack@users.noreply.github.com>"
```

## License

This code is open source software licensed under the [Apache 2.0 License]("http://www.apache.org/licenses/LICENSE-2.0.html").
